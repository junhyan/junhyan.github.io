<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>ECUI前端框架之路由 | 这就是个木匣子</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/very-simple.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"></head><body><!-- include the sidebar--><!-- include ./includes/sidebar.jade--><!-- Blog title and subtitle--><header><div class="container header"><a id="logo" href="/." class="title">这就是个木匣子</a><span class="subtitle"></span><label id="toggle-menu" for="menu" onclick><i class="fa fa-bars"></i></label></div></header><!-- use checkbox hack for toggle nav-bar on small screens--><input id="menu" type="checkbox"><!-- Navigation Links--><nav id="nav"><div class="container"><a href="/" class="sidebar-nav-item active">首页</a><a href="/archives" class="sidebar-nav-item">归档</a></div></nav><div id="header-margin-bar"></div><!-- gallery that comes before the header--><div class="wrapper"><div class="container post-header"><h1>ECUI前端框架之路由</h1></div></div><div class="wrapper"><div class="container meta"><div class="post-time">2018-03-04</div></div></div><article><div class="container post"><p>笔记，请忽略</p>
<h2 id="请忽略"><a href="#请忽略" class="headerlink" title="请忽略"></a>请忽略</h2><p>esr.load</p>
<p>dom.ready(function () {<br>    if (esr.onready) {<br>        callRoute(esr.onready());<br>    } else {<br>        init();<br>    }<br>});</p>
<p>如果index中有route即有esr.onready，执行这个路由callRoute，如果没有，则直接init（）<br>init();<br>window.onhashchange = listener;设置当url的锚变化时候执行listener处理函数<br>esr.redirect(esr.getLocation()); listener调用redirect，重新渲染页面</p>
<p>redirect中的一些处理先忽略，不仔细分析，是一些cache的操作，最后是会调用callRoute<br>callRoute渲染新路由，如果有路由esr.render(route)，<br>具体会做一下判断：<br>if (!route.model) {<br>    esr.render(route);<br>} else if (‘function’ === typeof route.model) {<br>    if (route.model(context, function () {<br>            esr.render(route);<br>        }) !== false) {<br>        esr.render(route);<br>    }<br>} else if (!route.model.length) {<br>    esr.render(route);<br>} else {<br>    if (route.onbeforerequest) {<br>        route.onbeforerequest(context);<br>    }<br>    esr.request(route.model, function () {<br>        esr.render(route);<br>    });<br>    if (route.onafterrequest) {<br>        route.onafterrequest(context);<br>    }<br>}<br>当model为空，或者model没有数据的时候，直接渲染。但model是function的时候执行route model函数。<br>当model请求存在，如果定义了onbeforerequest，执行该函数，执行esr.request函数请求数据，如果定义了<br>onafterrequest，则执行该函数。</p>
<p>但如果找不到路由，则会加载<br>io.loadScript(<br>    moduleName + ‘/‘ + moduleName + ‘.js’,<br>    function () {<br>        pauseStatus = false;<br>        callRoute(name, options);<br>    },<br>    {<br>        cache: true,<br>        onerror: function () {<br>            // 其他浏览器失败<br>            pauseStatus = false;<br>        }<br>    }<br>);</p>
<p>moduleName是var moduleName = name.split(‘.’)[0];name就是锚<br>对于开发环境，继续通过loadRoute的方法加载route.xxxx.xx.css,route.xxxx.xx.js,route.xxxx.xx.html<br>在生产环境中，所有的addRoute函数都被添加到了moduleName.js文件中。不会有loadRoute操作。</p>
<p>autoChildRoute<br>转载请注明: <a href="http://jhyan.me/" target="_blank" rel="noopener">http://jhyan.me/</a></p>
</div><!-- comment system--><div class="container"><hr></div></article><footer id="footer"><div class="container"><div class="bar"><div class="social"><a href="mailto:yanjunhan@163.com" target="_blank"><i class="fa fa-envelope-o"></i></a><a href="https://github.com/junhyan" target="_blank"><i class="fa fa-github"></i></a><a href="/atom.xml" target="_blank"><i class="fa fa-rss"></i></a></div><div class="footer">© 2018 <a href="/" rel="nofollow">woodenbox</a>.</div></div></div></footer><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
    $(".fancybox").fancybox();
});
</script></body></html>